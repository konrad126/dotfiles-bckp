
#!/usr/bin/env bash
source constants
#
# args:
#
# $1 module name
function module_exists()
{
	module_path="$MODULES_PATH/$1"
	if [ -d $module_path ];then
		return 0
	fi
	return 1
}


#
# args:
#
# $1 module name
function module_config_exists()
{
	module_config_path="$CONFIG_PATH/$1.config"
	if [ -e $module_config_path ];then
		return 0
	fi
	return 1
}


#
# args:
#
# $1 module name
function init_module()
{
	module=$1
	if module_config_exists $module;then
		echo "Module $module already initialized"
		return
	fi

	echo "Ititializing module: $module"
	cp -v "$MODULES_PATH/$module/config" "$CONFIG_PATH/$module.config"

}


#
# init all modules
function init_modules()
{
	for f in "../modules"/*;
	do
		module=$(basename $f)
		init_module $module
	done
}


#
# args:
#
# $1 module name
function process_module()
{

	module=$1
	echo "Processing module: $module";

	if ! module_exists $module;then
		echo "Module $module does not exist!"
		return 1
	fi

	if ! module_config_exists $module;then
		echo "Module $module config does not exist - initialize module!"
		return 1
	fi

	source "../modules/$module/config"
	source process_functions
	process_directory $SOURCE_FOLDER $DEST_FOLDER $MODE "${IGNORE[@]}"
	echo "Done"
}


#
# process all modules
function process_modules()
{
	# process all modules
	for f in "../modules"/*;
	do
		module=$(basename $f)
		process_module $module
	done
}