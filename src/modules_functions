
#!/usr/bin/env bash

source src/constants
#
# args:
#
# $1 module name
function module_exists()
{
	local module_name=$1
	local module_path="$MODULES_PATH/$module_name"
	if [ -d $module_path ];then
		return 0
	fi
	return 1
}


#
# args:
#
# $1 module name
function module_config_exists()
{
	local module_name=$1
	local module_config_path="$CONFIG_PATH/$module_name.config"
	if [ -e $module_config_path ];then
		return 0
	fi
	return 1
}


#
# args:
#
# $1 module name
function init_module()
{

	local module=$1
	if module_config_exists $module;then
		echo "Module $module already initialized"
		return
	fi

	echo "Initializing module: $module"
	ditto -v $CONFIG_STUB_PATH "$CONFIG_PATH/$module.config"
	echo "Module initialized - go configure it"
}


#
# init all modules
function init_modules()
{
	for f in "$MODULES_PATH"/*;
	do
		module=$(basename $f)
		init_module $module
	done
}


function display_module_info()
{
	if [ -e $MODULES_PATH/$module.info ];then
		cat $MODULES_PATH/$module.info
	fi
}
#
# args:
#
# $1 module name
function process_module()
{

	local module=$1
	echo "Adding module: $module";

	if ! module_exists $module;then
		echo "Module $module does not exist!"
		return 1
	fi

	if ! module_config_exists $module;then
		echo "Module $module config does not exist - initialize module!"
		return 1
	fi

	source "$CONFIG_PATH/$module.config"
	source src/file_functions
	process_directory $MODULES_PATH/$module $DEST_FOLDER $MODE "${IGNORE[@]}"


	display_module_info $module

	echo "Done"
}


#
# process all modules
function process_modules()
{
	# process all modules
	for f in $MODULES_PATH/*;
	do
		module=$(basename $f)
		process_module $module
	done
}